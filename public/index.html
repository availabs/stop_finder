<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
<script src="https://d3js.org/d3.v4.min.js" /></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"/></script>
<script src="./javascripts/paramHelpers.js" /></script> <!-- Helps with window/url search params -->
<script src="./javascripts/prettyDataKeys.js" /></script> <!-- Helps with formatting ugly data keys from DB -->
<script src="./javascripts/getDataHelpers.js" /></script> <!-- Helps with getting data (realtime or static bus stops) -->
<script src="./javascripts/displayHelpers.js" /></script> <!-- Helps with displaying data or display changes -->
<link rel="stylesheet" href="/stylesheets/style.css">
<div class='container-fluid' id="page_container">
  <div class="row no-gutters fixed-top" id="header_container">
    <div class="col-6">
      <div class="card text-center" id="bus">
        <div class="card-block" onClick="changeMode('bus')">
          <h1 class="card-title btn titleBtn">Bus</h1>
        </div>
      </div>
    </div>
    <div class="col-6">
      <div class="card text-center" id="train">
        <div class="card-block" onClick="changeMode('train')">
          <h1 class="card-title btn titleBtn">Train</h1>
        </div>
      </div>
    </div>
  </div>
  <div id="stops"></div>
</div>
<script>  
  var params = getSearchParameters();

  var mode = getMode()

  //Style button to reflect select transportation mode
  d3.select("#"+mode).classed("activeMode",true)

  if(navigator && navigator.geolocation){
    navigator.geolocation.getCurrentPosition(position => {

      /*
      * If URL has params, use those
      */
      var start = [ 
        params.lat || position.coords.latitude,
        params.lng || position.coords.longitude
      ]

      /*
      *
      * LEAFLET TAKES COORDS AS: LAT/LNG
      * POSTGIS TAKES COORDS AS: LNG/LAT
      * Parameter is LAT/LNG in order to work with Leaflet
      * Function reverses it when creating URL to get data
      *
      */
      getBusStopData(start,mode)

    })
  }
  else{

    var start = [ 
      params.lat || null,
      params.lng || null
    ]

    if(params[0] && params[1]){
      getBusStopData(start,mode)
    }
    else{
      console.log("No location was provided")
    }


  }
</script>